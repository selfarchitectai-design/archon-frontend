<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARCHON V2.4 Ultimate Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{--bg:#0a0a0f;--card:#1a1a24;--border:rgba(255,255,255,0.1)}
        *{font-family:'Inter',-apple-system,sans-serif}.mono{font-family:'JetBrains Mono',monospace}
        body{background:var(--bg);color:#e5e7eb;min-height:100vh;line-height:1.5}
        .flex{display:flex}.flex-1{flex:1}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}
        .grid{display:grid}.grid-2{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(3,1fr)}.grid-4{grid-template-columns:repeat(4,1fr)}.grid-5{grid-template-columns:repeat(5,1fr)}.grid-6{grid-template-columns:repeat(6,1fr)}
        .p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}
        .px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}
        .mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.ml-64{margin-left:16rem}
        .pt-16{padding-top:4rem}.space-y > *+*{margin-top:1rem}
        .w-2{width:.5rem}.w-3{width:.75rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-8{width:2rem}.w-full{width:100%}
        .h-2{height:.5rem}.h-3{height:.75rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}
        .text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.text-4xl{font-size:2.25rem}
        .font-medium{font-weight:500}.font-semibold{font-weight:600}.font-bold{font-weight:700}.text-center{text-align:center}
        .text-white{color:#fff}.text-gray-400{color:#9ca3af}.text-gray-500{color:#6b7280}
        .text-blue-400{color:#60a5fa}.text-purple-400{color:#a78bfa}.text-cyan-400{color:#22d3ee}.text-green-400{color:#4ade80}.text-orange-400{color:#fb923c}.text-red-400{color:#f87171}.text-pink-400{color:#f472b6}.text-yellow-400{color:#facc15}
        .bg-white\/5{background:rgba(255,255,255,.05)}.bg-white\/10{background:rgba(255,255,255,.1)}.bg-black\/30{background:rgba(0,0,0,.3)}
        .bg-green-500\/20{background:rgba(34,197,94,.2)}.bg-red-500\/20{background:rgba(239,68,68,.2)}.bg-blue-500\/20{background:rgba(59,130,246,.2)}.bg-purple-500\/20{background:rgba(139,92,246,.2)}.bg-cyan-500\/20{background:rgba(6,182,212,.2)}.bg-orange-500\/20{background:rgba(249,115,22,.2)}.bg-yellow-500\/20{background:rgba(234,179,8,.2)}
        .border{border:1px solid var(--border)}.border-b{border-bottom:1px solid var(--border)}.border-l-2{border-left:2px solid}
        .rounded{border-radius:.25rem}.rounded-lg{border-radius:.5rem}.rounded-xl{border-radius:.75rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}
        .overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.cursor-pointer{cursor:pointer}.transition{transition:all .2s}
        .fixed{position:fixed}.relative{position:relative}.absolute{position:absolute}.top-0{top:0}.left-0{left:0}.right-0{right:0}.top-16{top:4rem}.bottom-0{bottom:0}.z-50{z-index:50}
        .glass{background:rgba(26,26,36,.9);backdrop-filter:blur(20px);border:1px solid var(--border)}
        .glass:hover{border-color:rgba(139,92,246,.3)}
        .gradient-text{background:linear-gradient(135deg,#3b82f6,#8b5cf6,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .pulse{animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .blink{animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
        .tab-active{background:linear-gradient(135deg,rgba(59,130,246,.2),rgba(139,92,246,.2));border-color:rgba(139,92,246,.5)}
        .metric:hover{transform:translateY(-4px);box-shadow:0 20px 40px rgba(139,92,246,.2)}
        button{background:none;border:none;cursor:pointer;color:inherit}a{color:inherit;text-decoration:none}
        .n8n-grad{background:linear-gradient(135deg,#ff6d5a,#ff9472)}.mcp-grad{background:linear-gradient(135deg,#06b6d4,#8b5cf6)}.vercel-grad{background:#000;border:1px solid #333}
        .progress{height:8px;background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden}.progress-bar{height:100%;border-radius:4px;transition:width .3s}
        .flow{stroke-dasharray:10;animation:flow 1s linear infinite}@keyframes flow{to{stroke-dashoffset:-20}}
        .truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .live-dot{width:8px;height:8px;background:#22c55e;border-radius:50%;animation:livePulse 1.5s infinite}
        @keyframes livePulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,.7)}70%{box-shadow:0 0 0 10px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}
        .scroll-y{max-height:300px;overflow-y:auto}
        .activity-item{animation:slideIn .3s ease-out}
        @keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .conn-line{stroke-dasharray:5;animation:connFlow 1.5s linear infinite}
        @keyframes connFlow{to{stroke-dashoffset:-10}}
        .status-ok{color:#4ade80;background:rgba(34,197,94,.15);border:1px solid rgba(34,197,94,.3)}
        .status-warn{color:#facc15;background:rgba(234,179,8,.15);border:1px solid rgba(234,179,8,.3)}
        .status-error{color:#f87171;background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.3)}
    </style>
</head>
<body>
<div id="app"></div>
<script>
const ENDPOINTS = {
    lambda: {
        brain: {url: 'https://jl67xd5pckkhjwdmnvhco2bg440grmtu.lambda-url.us-east-1.on.aws/', name: 'Brain'},
        actions: {url: 'https://qtomhtef66vivt7wzyit5nuzve0nzvbk.lambda-url.us-east-1.on.aws/', name: 'Actions'},
        trend: {url: 'https://mjfhxhcsi2u3o2pqhkj55rrlge0ucncm.lambda-url.us-east-1.on.aws/', name: 'Trend'},
        intake: {url: 'https://wbhdgr46itplcvosjioitclvga0mxlec.lambda-url.us-east-1.on.aws/', name: 'Intake'}
    },
    vercel: {
        main: 'https://www.selfarchitectai.com',
        dashboard: 'https://www.selfarchitectai.com/dashboard'
    },
    n8n: {
        base: 'https://n8n.selfarchitectai.com',
        health: 'https://n8n.selfarchitectai.com/healthz'
    },
    github: 'https://api.github.com/repos/selfarchitectai-design/archon-v2-platform',
    api: 'https://d6gy1zr8vj.execute-api.us-east-1.amazonaws.com/prod'
};

let state = {
    tab: 'overview',
    network: {},
    lambda: {},
    activities: [],
    lastCheck: null,
    loading: true
};

const I={
    brain:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>',
    server:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="8" x="2" y="2" rx="2"/><rect width="20" height="8" x="2" y="14" rx="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>',
    workflow:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="8" height="8" x="3" y="3" rx="2"/><path d="M7 11v4a2 2 0 0 0 2 2h4"/><rect width="8" height="8" x="13" y="13" rx="2"/></svg>',
    tool:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>',
    triangle:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 19h20L12 2z"/></svg>',
    network:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></svg>',
    plug:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22v-5M9 8V2M15 8V2M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"/></svg>',
    activity:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>',
    git:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>',
    refresh:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8M21 3v5h-5M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16M8 16H3v5"/></svg>',
    link:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>',
    globe:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>',
    zap:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>',
    wifi:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><circle cx="12" cy="20" r="1"/></svg>',
    check:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>',
    x:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',
    alert:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'
};

function icon(n,c=''){const s=c.includes('w-6')?24:c.includes('w-5')?20:16;return `<span class="${c}" style="display:inline-flex;width:${s}px;height:${s}px">${I[n]||I.zap}</span>`}

function addActivity(type, message, status='success') {
    state.activities.unshift({id: Date.now(), time: new Date().toLocaleTimeString('tr-TR'), type, message, status});
    if (state.activities.length > 30) state.activities.pop();
}

async function checkEndpoint(name, url, method='GET', body=null) {
    const start = Date.now();
    try {
        const opts = {method, headers: {'Content-Type': 'application/json'}};
        if (body) opts.body = JSON.stringify(body);
        const r = await fetch(url, opts);
        return {name, status: r.ok ? 'ok' : 'warn', code: r.status, latency: Date.now() - start};
    } catch(e) {
        return {name, status: 'error', code: 0, latency: Date.now() - start, error: e.message};
    }
}

async function checkAllNetwork() {
    addActivity('network', 'Network taraması başladı...', 'info');
    state.network = {};
    
    // Check Lambdas
    for (const [key, data] of Object.entries(ENDPOINTS.lambda)) {
        const result = await checkEndpoint(`lambda-${key}`, data.url, 'POST', {action: 'health'});
        state.network[`lambda-${key}`] = result;
        state.lambda[key] = {status: result.status === 'ok' ? 'healthy' : 'error', lat: result.latency};
        addActivity('lambda', `${data.name}: ${result.code} (${result.latency}ms)`, result.status);
    }
    
    // Check Vercel
    const vercelMain = await checkEndpoint('vercel-main', ENDPOINTS.vercel.main);
    state.network['vercel-main'] = vercelMain;
    addActivity('vercel', `Main: ${vercelMain.code}`, vercelMain.status);
    
    const vercelDash = await checkEndpoint('vercel-dashboard', ENDPOINTS.vercel.dashboard);
    state.network['vercel-dashboard'] = vercelDash;
    
    // Check N8N
    const n8nHealth = await checkEndpoint('n8n-health', ENDPOINTS.n8n.health);
    state.network['n8n'] = n8nHealth;
    addActivity('n8n', `Health: ${n8nHealth.code}`, n8nHealth.status);
    
    // Summary
    const okCount = Object.values(state.network).filter(n => n.status === 'ok').length;
    const total = Object.keys(state.network).length;
    
    state.lastCheck = new Date().toLocaleTimeString('tr-TR');
    state.loading = false;
    
    addActivity('network', `Tarama tamamlandı: ${okCount}/${total} OK`, okCount === total ? 'success' : 'warning');
    render();
}

function render() {
    document.getElementById('app').innerHTML = `${header()}<div class="flex">${sidebar()}<main class="flex-1 p-6 ml-64">${content()}</main></div>`;
}

function header() {
    const okCount = Object.values(state.network).filter(n => n.status === 'ok').length;
    const total = Object.keys(state.network).length || 1;
    const pct = Math.round((okCount / total) * 100);
    
    return `<header class="fixed top-0 left-0 right-0 z-50 glass border-b">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center gap-4">
                <div style="width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#3b82f6,#8b5cf6,#06b6d4);display:flex;align-items:center;justify-content:center">${icon('brain','w-6 text-white')}</div>
                <div><h1 class="text-xl font-bold gradient-text">ARCHON V2.4</h1><p class="text-xs text-gray-500">Network Status Dashboard</p></div>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 px-3 py-2 rounded-lg ${pct === 100 ? 'bg-green-500\/20' : pct > 70 ? 'bg-yellow-500\/20' : 'bg-red-500\/20'}">
                    <div class="live-dot" style="background:${pct === 100 ? '#22c55e' : pct > 70 ? '#facc15' : '#f87171'}"></div>
                    <span class="text-sm ${pct === 100 ? 'text-green-400' : pct > 70 ? 'text-yellow-400' : 'text-red-400'}">${pct}%</span>
                </div>
                <div class="px-3 py-2 rounded-lg bg-blue-500\/20 text-blue-400 text-sm">${okCount}/${total}</div>
                <div class="text-xs text-gray-500">${state.lastCheck || '--:--'}</div>
                <button onclick="checkAllNetwork()" class="p-2 rounded-lg transition bg-white\/5 hover:bg-white\/10">${icon('refresh','w-5 text-gray-400')}</button>
            </div>
        </div>
    </header>`;
}

function sidebar() {
    const tabs = [
        {id:'overview',i:'activity',l:'Overview'},
        {id:'network',i:'wifi',l:'Network Status'},
        {id:'connections',i:'network',l:'Connections'},
        {id:'vercel',i:'triangle',l:'Vercel'},
        {id:'n8n',i:'workflow',l:'N8N'},
        {id:'lambdas',i:'server',l:'Lambdas'},
        {id:'integrations',i:'plug',l:'All (63)'}
    ];
    
    return `<aside class="fixed left-0 top-16 bottom-0 overflow-y-auto" style="width:256px;background:rgba(26,26,36,.9);border-right:1px solid var(--border);padding:16px">
        <nav class="space-y">${tabs.map(t => `
            <button onclick="setTab('${t.id}')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition ${state.tab === t.id ? 'tab-active' : ''}">
                ${icon(t.i, `w-5 ${state.tab === t.id ? 'text-purple-400' : 'text-gray-500'}`)}
                <span class="${state.tab === t.id ? 'text-white font-medium' : 'text-gray-400'}">${t.l}</span>
            </button>
        `).join('')}</nav>
        
        <div class="mt-4 p-4 rounded-xl bg-white\/5">
            <div class="flex items-center gap-2 mb-3">
                <div class="live-dot"></div>
                <span class="text-xs font-medium">Activity Log</span>
            </div>
            <div class="space-y scroll-y" style="max-height:180px">
                ${state.activities.slice(0,6).map(a => `
                    <div class="activity-item flex items-start gap-2 py-1 border-l-2 pl-2 ${a.status === 'success' ? 'border-green-500' : a.status === 'error' ? 'border-red-500' : a.status === 'warning' ? 'border-yellow-500' : 'border-blue-500'}">
                        <span class="text-xs text-gray-500">${a.time.split(':').slice(0,2).join(':')}</span>
                        <span class="text-xs truncate">${a.message}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    </aside>`;
}

function content() {
    switch(state.tab) {
        case 'overview': return overview();
        case 'network': return networkStatus();
        case 'connections': return connections();
        case 'vercel': return vercel();
        case 'n8n': return n8n();
        case 'lambdas': return lambdas();
        case 'integrations': return integrations();
        default: return overview();
    }
}

function statusBadge(status) {
    if (status === 'ok') return '<span class="px-2 py-1 rounded text-xs status-ok">✓ OK</span>';
    if (status === 'warn') return '<span class="px-2 py-1 rounded text-xs status-warn">⚠ WARN</span>';
    return '<span class="px-2 py-1 rounded text-xs status-error">✗ ERROR</span>';
}

function overview() {
    const lambdaOk = Object.values(state.lambda).filter(l => l.status === 'healthy').length;
    const networkOk = Object.values(state.network).filter(n => n.status === 'ok').length;
    const total = Object.keys(state.network).length || 1;
    
    return `<div class="pt-16 space-y">
        <div class="grid grid-4 gap-4">
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-green-400">${lambdaOk}/4</p><p class="text-sm text-gray-400">Lambda</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-cyan-400">${networkOk}/${total}</p><p class="text-sm text-gray-400">Endpoints</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-purple-400">17</p><p class="text-sm text-gray-400">N8N</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-orange-400">63</p><p class="text-sm text-gray-400">Total</p></div>
        </div>
        
        <div class="grid grid-2 gap-6">
            <div class="glass rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">${icon('server','w-5 text-blue-400')} Lambda Status</h2>
                <div class="space-y">
                    ${Object.entries(state.lambda).map(([k,v]) => `
                        <div class="flex items-center justify-between p-3 rounded-lg bg-white\/5">
                            <div class="flex items-center gap-3">
                                <span class="w-2 h-2 rounded-full ${v.status === 'healthy' ? 'bg-green-400' : 'bg-red-400'} pulse"></span>
                                <span class="font-medium">archon-${k}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs mono text-gray-500">${v.lat}ms</span>
                                ${statusBadge(v.status === 'healthy' ? 'ok' : 'error')}
                            </div>
                        </div>
                    `).join('') || '<p class="text-gray-500">Loading...</p>'}
                </div>
            </div>
            
            <div class="glass rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">${icon('wifi','w-5 text-cyan-400')} Network Endpoints</h2>
                <div class="space-y scroll-y">
                    ${Object.entries(state.network).map(([k,v]) => `
                        <div class="flex items-center justify-between p-2 rounded-lg bg-white\/5">
                            <span class="text-sm">${k}</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs mono text-gray-500">${v.latency}ms</span>
                                ${statusBadge(v.status)}
                            </div>
                        </div>
                    `).join('') || '<p class="text-gray-500">Checking...</p>'}
                </div>
            </div>
        </div>
        
        <div class="glass rounded-2xl p-6">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">${icon('activity','w-5 text-green-400')} Live Activity</h2>
            <div class="grid grid-3 gap-4">
                ${state.activities.slice(0,9).map(a => `
                    <div class="p-3 rounded-lg bg-white\/5 border-l-2 ${a.status === 'success' ? 'border-green-500' : a.status === 'error' ? 'border-red-500' : a.status === 'warning' ? 'border-yellow-500' : 'border-blue-500'}">
                        <p class="text-sm">${a.message}</p>
                        <p class="text-xs text-gray-500 mt-1">${a.time}</p>
                    </div>
                `).join('')}
            </div>
        </div>
    </div>`;
}

function networkStatus() {
    const groups = {
        'Lambda Functions': Object.entries(state.network).filter(([k]) => k.startsWith('lambda')),
        'Vercel': Object.entries(state.network).filter(([k]) => k.startsWith('vercel')),
        'N8N': Object.entries(state.network).filter(([k]) => k.startsWith('n8n'))
    };
    
    return `<div class="pt-16 space-y">
        <div class="flex items-center justify-between">
            <h1 class="text-2xl font-bold flex items-center gap-3">${icon('wifi','w-8 text-cyan-400')} Network Status</h1>
            <button onclick="checkAllNetwork()" class="px-4 py-2 rounded-lg bg-purple-500\/20 text-purple-400 flex items-center gap-2">${icon('refresh','w-4')} Rescan</button>
        </div>
        
        ${Object.entries(groups).map(([group, items]) => `
            <div class="glass rounded-2xl p-6">
                <h2 class="text-lg font-semibold mb-4">${group}</h2>
                <div class="grid grid-2 gap-4">
                    ${items.map(([k,v]) => `
                        <div class="p-4 rounded-xl bg-white\/5 flex items-center justify-between">
                            <div>
                                <p class="font-medium">${k}</p>
                                <p class="text-xs text-gray-500">HTTP ${v.code} • ${v.latency}ms</p>
                            </div>
                            ${statusBadge(v.status)}
                        </div>
                    `).join('') || '<p class="text-gray-500">No data</p>'}
                </div>
            </div>
        `).join('')}
        
        <div class="glass rounded-2xl p-6">
            <h2 class="text-lg font-semibold mb-4">Connection Matrix</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="text-left text-gray-500">
                        <th class="p-2">Endpoint</th>
                        <th class="p-2">Status</th>
                        <th class="p-2">Code</th>
                        <th class="p-2">Latency</th>
                    </tr></thead>
                    <tbody>
                        ${Object.entries(state.network).map(([k,v]) => `
                            <tr class="border-t border-white\/5">
                                <td class="p-2 mono">${k}</td>
                                <td class="p-2">${statusBadge(v.status)}</td>
                                <td class="p-2 mono">${v.code}</td>
                                <td class="p-2 mono ${v.latency < 500 ? 'text-green-400' : v.latency < 1000 ? 'text-yellow-400' : 'text-red-400'}">${v.latency}ms</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    </div>`;
}

function connections() {
    return `<div class="pt-16 space-y">
        <h1 class="text-2xl font-bold">Network Connections</h1>
        
        <div class="glass rounded-2xl p-6">
            <h2 class="text-lg font-semibold mb-4">Live Architecture</h2>
            <div class="relative bg-black\/30 rounded-xl p-4" style="height:400px">
                <svg viewBox="0 0 1000 350" class="w-full h-full">
                    <defs>
                        <linearGradient id="connGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.8"/>
                            <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0.8"/>
                        </linearGradient>
                        <filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                    </defs>
                    
                    <!-- User -->
                    <g transform="translate(80,175)">
                        <circle r="35" fill="${state.network['vercel-main']?.status === 'ok' ? 'rgba(34,197,94,0.3)' : 'rgba(239,68,68,0.3)'}" stroke="${state.network['vercel-main']?.status === 'ok' ? 'rgba(34,197,94,0.8)' : 'rgba(239,68,68,0.8)'}" stroke-width="2"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="11">USER</text>
                    </g>
                    
                    <!-- Vercel -->
                    <g transform="translate(220,175)">
                        <rect x="-50" y="-30" width="100" height="60" rx="8" fill="${state.network['vercel-main']?.status === 'ok' ? 'rgba(255,255,255,0.1)' : 'rgba(239,68,68,0.2)'}" stroke="rgba(255,255,255,0.5)" stroke-width="2"/>
                        <text y="-5" text-anchor="middle" fill="white" font-size="11" font-weight="600">▲ VERCEL</text>
                        <text y="12" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="9">${state.network['vercel-main']?.latency || 0}ms</text>
                    </g>
                    
                    <!-- N8N -->
                    <g transform="translate(220,70)">
                        <rect x="-40" y="-25" width="80" height="50" rx="6" fill="${state.network['n8n']?.status === 'ok' ? 'rgba(255,109,90,0.3)' : 'rgba(239,68,68,0.3)'}" stroke="rgba(255,109,90,0.8)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="11">N8N</text>
                    </g>
                    
                    <!-- API Gateway -->
                    <g transform="translate(400,175)">
                        <rect x="-60" y="-35" width="120" height="70" rx="10" fill="rgba(59,130,246,0.2)" stroke="rgba(59,130,246,0.6)" stroke-width="2"/>
                        <text y="-8" text-anchor="middle" fill="white" font-size="12" font-weight="600">API GATEWAY</text>
                        <text y="10" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="9">REST + Auth</text>
                    </g>
                    
                    <!-- Lambdas -->
                    <g transform="translate(600,80)">
                        <rect x="-45" y="-22" width="90" height="44" rx="6" fill="${state.lambda.brain?.status === 'healthy' ? 'rgba(59,130,246,0.4)' : 'rgba(239,68,68,0.4)'}" stroke="rgba(59,130,246,0.8)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="10">Brain ${state.lambda.brain?.lat || 0}ms</text>
                    </g>
                    <g transform="translate(600,140)">
                        <rect x="-45" y="-22" width="90" height="44" rx="6" fill="${state.lambda.actions?.status === 'healthy' ? 'rgba(249,115,22,0.4)' : 'rgba(239,68,68,0.4)'}" stroke="rgba(249,115,22,0.8)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="10">Actions ${state.lambda.actions?.lat || 0}ms</text>
                    </g>
                    <g transform="translate(600,200)">
                        <rect x="-45" y="-22" width="90" height="44" rx="6" fill="${state.lambda.trend?.status === 'healthy' ? 'rgba(6,182,212,0.4)' : 'rgba(239,68,68,0.4)'}" stroke="rgba(6,182,212,0.8)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="10">Trend ${state.lambda.trend?.lat || 0}ms</text>
                    </g>
                    <g transform="translate(600,260)">
                        <rect x="-45" y="-22" width="90" height="44" rx="6" fill="${state.lambda.intake?.status === 'healthy' ? 'rgba(34,197,94,0.4)' : 'rgba(239,68,68,0.4)'}" stroke="rgba(34,197,94,0.8)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="10">Intake ${state.lambda.intake?.lat || 0}ms</text>
                    </g>
                    
                    <!-- Storage -->
                    <g transform="translate(800,140)">
                        <rect x="-50" y="-30" width="100" height="60" rx="8" fill="rgba(249,115,22,0.2)" stroke="rgba(249,115,22,0.6)"/>
                        <text y="-5" text-anchor="middle" fill="white" font-size="11">DynamoDB</text>
                        <text y="12" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="9">Storage</text>
                    </g>
                    
                    <!-- GitHub -->
                    <g transform="translate(800,230)">
                        <rect x="-45" y="-25" width="90" height="50" rx="6" fill="rgba(139,92,246,0.2)" stroke="rgba(139,92,246,0.6)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="11">GitHub</text>
                    </g>
                    
                    <!-- Slack -->
                    <g transform="translate(920,175)">
                        <rect x="-35" y="-22" width="70" height="44" rx="6" fill="rgba(34,197,94,0.2)" stroke="rgba(34,197,94,0.6)"/>
                        <text y="5" text-anchor="middle" fill="white" font-size="10">Slack</text>
                    </g>
                    
                    <!-- Connections -->
                    <line x1="115" y1="175" x2="170" y2="175" stroke="url(#connGrad)" stroke-width="3" class="conn-line"/>
                    <line x1="180" y1="95" x2="180" y2="145" stroke="rgba(255,109,90,0.5)" stroke-width="2" class="conn-line"/>
                    <line x1="270" y1="175" x2="340" y2="175" stroke="url(#connGrad)" stroke-width="3" class="conn-line"/>
                    
                    <line x1="460" y1="155" x2="555" y2="80" stroke="rgba(59,130,246,0.4)" stroke-width="2" class="conn-line"/>
                    <line x1="460" y1="165" x2="555" y2="140" stroke="rgba(249,115,22,0.4)" stroke-width="2" class="conn-line"/>
                    <line x1="460" y1="185" x2="555" y2="200" stroke="rgba(6,182,212,0.4)" stroke-width="2" class="conn-line"/>
                    <line x1="460" y1="195" x2="555" y2="260" stroke="rgba(34,197,94,0.4)" stroke-width="2" class="conn-line"/>
                    
                    <line x1="645" y1="140" x2="750" y2="140" stroke="rgba(249,115,22,0.3)" stroke-width="2" class="conn-line"/>
                    <line x1="645" y1="200" x2="755" y2="230" stroke="rgba(139,92,246,0.3)" stroke-width="2" class="conn-line"/>
                    <line x1="845" y1="175" x2="885" y2="175" stroke="rgba(34,197,94,0.3)" stroke-width="2" class="conn-line"/>
                </svg>
            </div>
        </div>
        
        <div class="grid grid-3 gap-4">
            <div class="glass rounded-xl p-4 text-center">
                <p class="text-3xl font-bold text-green-400">${Object.values(state.lambda).filter(l => l.status === 'healthy').length}/4</p>
                <p class="text-sm text-gray-400">Lambda OK</p>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <p class="text-3xl font-bold text-cyan-400">${Object.values(state.network).filter(n => n.status === 'ok').length}/${Object.keys(state.network).length}</p>
                <p class="text-sm text-gray-400">Endpoints OK</p>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <p class="text-3xl font-bold text-purple-400">${Math.round(Object.values(state.lambda).reduce((a,b) => a + b.lat, 0) / 4) || 0}ms</p>
                <p class="text-sm text-gray-400">Avg Latency</p>
            </div>
        </div>
    </div>`;
}

function vercel() {
    return `<div class="pt-16 space-y">
        <h1 class="text-2xl font-bold flex items-center gap-3">${icon('triangle','w-8')} Vercel</h1>
        <div class="grid grid-3 gap-4">
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold">▲</p><p class="text-sm text-gray-400">archon-frontend</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-green-400">3</p><p class="text-sm text-gray-400">Domains</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-purple-400">18</p><p class="text-sm text-gray-400">Env Vars</p></div>
        </div>
        <div class="glass rounded-2xl p-6">
            <h2 class="text-lg font-semibold mb-4">Endpoint Status</h2>
            <div class="space-y">
                ${['vercel-main', 'vercel-dashboard'].map(k => {
                    const v = state.network[k] || {status: 'unknown', code: 0, latency: 0};
                    return `<div class="flex items-center justify-between p-3 rounded-lg bg-white\/5">
                        <span class="font-medium">${k}</span>
                        <div class="flex items-center gap-3">
                            <span class="mono text-xs">${v.latency}ms</span>
                            ${statusBadge(v.status)}
                        </div>
                    </div>`;
                }).join('')}
            </div>
        </div>
    </div>`;
}

function n8n() {
    return `<div class="pt-16 space-y">
        <h1 class="text-2xl font-bold">N8N Workflows</h1>
        <div class="grid grid-3 gap-4">
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-orange-400">17</p><p class="text-sm text-gray-400">Total</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-green-400">9</p><p class="text-sm text-gray-400">Scheduled</p></div>
            <div class="glass rounded-xl p-5 text-center"><p class="text-4xl font-bold text-purple-400">8</p><p class="text-sm text-gray-400">Webhook</p></div>
        </div>
        <div class="glass rounded-2xl p-6">
            <h2 class="text-lg font-semibold mb-4">Health Status</h2>
            ${state.network['n8n'] ? `
                <div class="flex items-center justify-between p-4 rounded-lg bg-white\/5">
                    <span class="font-medium">N8N Cloud</span>
                    <div class="flex items-center gap-3">
                        <span class="mono text-xs">${state.network['n8n'].latency}ms</span>
                        ${statusBadge(state.network['n8n'].status)}
                    </div>
                </div>
            ` : '<p class="text-gray-500">Checking...</p>'}
        </div>
    </div>`;
}

function lambdas() {
    return `<div class="pt-16 space-y">
        <h1 class="text-2xl font-bold">Lambda Functions</h1>
        <div class="grid grid-2 gap-6">
            ${Object.entries(state.lambda).map(([k,v]) => `
                <div class="glass rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">archon-${k}</h3>
                        ${statusBadge(v.status === 'healthy' ? 'ok' : 'error')}
                    </div>
                    <div class="space-y">
                        <div class="flex justify-between"><span class="text-gray-500">Status</span><span class="${v.status === 'healthy' ? 'text-green-400' : 'text-red-400'}">${v.status}</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Latency</span><span class="mono">${v.lat}ms</span></div>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500">Loading...</p>'}
        </div>
    </div>`;
}

function integrations() {
    const items = [
        {n:'AWS Lambda',c:4,s:Object.values(state.lambda).filter(l=>l.status==='healthy').length === 4 ? 'ok' : 'warn'},
        {n:'Vercel',c:3,s:state.network['vercel-main']?.status || 'unknown'},
        {n:'N8N',c:17,s:state.network['n8n']?.status || 'unknown'},
        {n:'GitHub',c:10,s:'ok'},
        {n:'DynamoDB',c:5,s:'ok'},
        {n:'API Gateway',c:7,s:'warn'},
        {n:'Slack',c:4,s:'ok'},
        {n:'MCP',c:4,s:'ok'}
    ];
    
    return `<div class="pt-16 space-y">
        <h1 class="text-2xl font-bold">All Integrations (63)</h1>
        <div class="grid grid-4 gap-4">
            ${items.map(i => `
                <div class="glass rounded-xl p-5">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${i.n}</span>
                        ${statusBadge(i.s)}
                    </div>
                    <p class="text-3xl font-bold">${i.c}</p>
                </div>
            `).join('')}
        </div>
    </div>`;
}

window.setTab = t => { state.tab = t; render(); };
window.checkAllNetwork = checkAllNetwork;

render();
checkAllNetwork();
setInterval(checkAllNetwork, 60000);
</script>
</body>
</html>
